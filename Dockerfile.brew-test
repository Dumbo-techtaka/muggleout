# Homebrew ì„¤ì¹˜ í…ŒìŠ¤íŠ¸ìš© ìµœì†Œ í™˜ê²½
FROM ubuntu:22.04

# í•„ìˆ˜ íŒ¨í‚¤ì§€ë§Œ ì„¤ì¹˜ (Homebrew ìš”êµ¬ì‚¬í•­)
RUN apt-get update && apt-get install -y \
    curl \
    git \
    sudo \
    build-essential \
    procps \
    file \
    && rm -rf /var/lib/apt/lists/*

# í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìž ìƒì„±
RUN useradd -m -s /bin/bash testuser && \
    echo "testuser:password" | chpasswd && \
    usermod -aG sudo testuser && \
    echo "testuser ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# ìž‘ì—… ë””ë ‰í† ë¦¬
WORKDIR /home/testuser

# í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬
COPY --chown=testuser:testuser test-brew-install.sh ./
COPY --chown=testuser:testuser start.sh ./

# ì‹¤í–‰ ê¶Œí•œ
RUN chmod +x *.sh

USER testuser

# í™˜ê²½ ë³€ìˆ˜
ENV TERM=xterm-256color

# ì‹œìž‘ ë©”ì‹œì§€
RUN echo 'echo "ðŸ§ª Homebrew ì„¤ì¹˜ í…ŒìŠ¤íŠ¸ í™˜ê²½"' >> ~/.bashrc && \
    echo 'echo "ì‹¤í–‰: ./test-brew-install.sh"' >> ~/.bashrc && \
    echo 'echo ""' >> ~/.bashrc

CMD ["/bin/bash"]