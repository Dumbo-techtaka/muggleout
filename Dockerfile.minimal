# 최소한의 테스트 환경 (가장 빠름)
FROM node:18-alpine

# bash만 추가
RUN apk add --no-cache bash

# 작업 디렉토리
WORKDIR /app

# 패키지 파일만 복사 (캐시 최적화)
COPY package*.json ./

# production 의존성만 설치
RUN npm ci --omit=dev --no-audit --no-fund

# 소스 복사
COPY . .

# 실행 권한
RUN chmod +x bin/dev-setup.js

# 링크 생성
RUN npm link

# 가짜 sw_vers
RUN printf '#!/bin/sh\necho "ProductName:    macOS"\necho "ProductVersion: 13.0"\n' > /usr/local/bin/sw_vers && \
    chmod +x /usr/local/bin/sw_vers

CMD ["/bin/bash"]